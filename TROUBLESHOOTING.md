# Устранение неполадок SoundBot2

В этом документе описаны распространенные проблемы и их решения при работе с SoundBot2.

## Проблемы с TTS (преобразование текста в речь)

### 1. Ошибка "module 'pyttsx3' has no attribute 'init'"

**Проблема**: При запуске бота возникает ошибка `AttributeError: module 'pyttsx3' has no attribute 'init'`.

**Решение**:
1. Переустановите pyttsx3:
   ```bash
   pip uninstall -y pyttsx3
   pip install pyttsx3==2.90
   ```
2. Если проблема не решена, проверьте, что установлены все зависимости:
   ```bash
   apt-get install -y espeak espeak-data libespeak-dev
   ```

### 2. Предупреждение "Full dictionary is not installed for 'ru'"

**Проблема**: При использовании pyttsx3 с русским языком появляется предупреждение `Full dictionary is not installed for 'ru'`.

**Решение**:
1. Установите дополнительные пакеты для поддержки русского языка:
   ```bash
   apt-get install -y espeak-data espeak-ng-data
   ```
2. Бот автоматически переключится на другой движок TTS (espeak напрямую или Google TTS), если pyttsx3 не сможет найти подходящий голос для русского языка.

### 3. Ошибка "weakly-referenced object no longer exists"

**Проблема**: При использовании pyttsx3 появляется ошибка `ReferenceError: weakly-referenced object no longer exists`.

**Решение**:
1. Это связано с тем, что объект уничтожается до завершения синтеза речи. В коде уже добавлена задержка для решения этой проблемы.
2. Если проблема сохраняется, увеличьте задержку в файле `app/utils/tts_converter.py`:
   ```python
   # Увеличьте время задержки с 0.5 до 1.0 секунды
   time.sleep(1.0)
   ```

## Проблемы с Telegram API

### 1. Ошибка "Unauthorized"

**Проблема**: При запуске бота возникает ошибка `telegram.error.Unauthorized: Unauthorized`.

**Решение**:
1. Проверьте правильность токена в файле `.env`:
   ```
   TELEGRAM_TOKEN=your_telegram_token
   ```
2. Убедитесь, что бот не был заблокирован или деактивирован.
3. Создайте нового бота через @BotFather и получите новый токен.

### 2. Ошибка "Network is unreachable"

**Проблема**: При запуске бота возникает ошибка `telegram.error.NetworkError: Network is unreachable`.

**Решение**:
1. Проверьте подключение к интернету.
2. Если вы используете прокси, проверьте его настройки.
3. Если вы находитесь в стране, где Telegram заблокирован, настройте VPN или прокси.

## Проблемы с базой данных

### 1. Ошибка "no such table"

**Проблема**: При запуске бота возникает ошибка `sqlite3.OperationalError: no such table`.

**Решение**:
1. Удалите файл базы данных и перезапустите бота:
   ```bash
   rm -f db/bot.db
   ```
2. Бот автоматически создаст новую базу данных при запуске.

## Проблемы с аудиофайлами

### 1. Ошибка "No such file or directory"

**Проблема**: При конвертации текста в речь возникает ошибка `FileNotFoundError: No such file or directory`.

**Решение**:
1. Убедитесь, что директория `temp` существует и доступна для записи:
   ```bash
   mkdir -p temp
   chmod 777 temp
   ```

### 2. Ошибка "ffmpeg not found"

**Проблема**: При обработке аудиофайлов возникает ошибка `FileNotFoundError: ffmpeg not found`.

**Решение**:
1. Установите ffmpeg:
   ```bash
   apt-get install -y ffmpeg
   ```

## Общие проблемы

### 1. Ошибка "Permission denied"

**Проблема**: При запуске бота возникает ошибка `PermissionError: Permission denied`.

**Решение**:
1. Убедитесь, что у вас есть права на запись в директории проекта:
   ```bash
   chmod -R 755 /path/to/soundbot2
   ```
2. Если вы используете Docker, убедитесь, что контейнер имеет доступ к нужным директориям.

### 2. Бот не отвечает на сообщения

**Проблема**: Бот запускается без ошибок, но не отвечает на сообщения.

**Решение**:
1. Проверьте логи в файле `logs/bot.log`.
2. Убедитесь, что бот не находится в режиме приватности (настройки в @BotFather).
3. Проверьте, что вы отправляете сообщения правильному боту (проверьте username бота).
4. Перезапустите бота с помощью скрипта `run.sh`.

## Как запустить проверку работоспособности

Для проверки работоспособности бота выполните:

```bash
python check_bot.py
```

Для проверки доступных голосов выполните:

```bash
python check_voices.py
```

Для тестирования конвертации текста в речь выполните:

```bash
python test_tts.py
```

## Контакты для поддержки

Если вы не смогли решить проблему с помощью этого руководства, обратитесь к разработчику:

- Email: support@example.com
- Telegram: @support_bot