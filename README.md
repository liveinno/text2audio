# text2audio - Бот для конвертации текста в аудиокниги

SoundBot2 - это Telegram-бот, который позволяет конвертировать текст в аудиокниги с использованием различных движков синтеза речи.

## Возможности

- Конвертация текста в аудиофайлы
- Поддержка различных языков (русский, английский, французский, немецкий, испанский, итальянский)
- Выбор типа голоса (мужской/женский)
- Выбор движка синтеза речи (Google TTS, pyttsx3, eSpeak, Festival)
- Выбор формата аудио (mp3, wav, ogg)
- Обработка текстовых файлов (txt, docx)

## Установка и запуск

1. Клонируйте репозиторий:
```
git clone https://github.com/liveinno/text2audio.git
cd text2audio
```

2. Установите зависимости:
```
pip install -r requirements.txt
```

3. Установите дополнительные движки синтеза речи (опционально):
```
bash install_tts_engines.sh
```

4. Создайте файл `.env` с настройками:
```
TELEGRAM_TOKEN=your_telegram_token
ADMIN_USER_IDS=123456789,987654321
DEFAULT_TTS_ENGINE=gtts
DEFAULT_VOICE_TYPE=female
DEFAULT_LANGUAGE=ru
DEFAULT_AUDIO_FORMAT=mp3
```

5. Запустите бота:
```
# Запуск с проверкой работоспособности
./run.sh

# Запуск в фоновом режиме (daemon)
./run_daemon.sh

# Остановка бота
./stop.sh

# Или запуск напрямую
python main.py
```

## Проверка работоспособности

Для проверки работоспособности бота выполните:

```
python check_bot.py
```

Для проверки доступных голосов выполните:

```
python check_voices.py
```

## Команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/settings` - Настройки бота
- `/reset` - Сбросить настройки
- `/cancel` - Отменить текущую задачу

## Устранение неполадок

Если у вас возникают проблемы с ботом, проверьте:

1. Правильность настроек в файле `.env`
2. Наличие всех необходимых зависимостей
3. Доступность выбранных движков синтеза речи
4. Логи в файле `logs/bot.log`

Подробное руководство по устранению неполадок доступно в файле [TROUBLESHOOTING.md](TROUBLESHOOTING.md).

## Известные проблемы и их решение

### Проблема с pyttsx3

Если вы видите ошибку `module 'pyttsx3' has no attribute 'init'`, попробуйте переустановить pyttsx3:

```
pip uninstall -y pyttsx3
pip install pyttsx3==2.90
```

### Проблема с русским языком в espeak

Если вы видите сообщение `Full dictionary is not installed for 'ru'`, установите полный словарь для русского языка:

```
apt-get update && apt-get install -y espeak-data espeak-ng-data
```

Бот автоматически переключится на другой движок TTS (espeak напрямую или Google TTS), если pyttsx3 не сможет найти подходящий голос для русского языка.

### Проблема с weakly-referenced object

Если вы видите ошибку `ReferenceError: weakly-referenced object no longer exists`, это связано с тем, что объект уничтожается до завершения синтеза речи. В коде уже добавлена задержка для решения этой проблемы.

## Лицензия

MIT
